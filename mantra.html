<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mantra - Home Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Coming+Soon&family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="shared.js"></script>
    <style>
        :root {
            --paper-bg: #fff;
            --line-color: #f0ede6;
            --margin-line: #f6d2a2;
            --text-color: #323130;
        }
        body { margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: #fff; }
        
        .content-area { 
            padding: 60px 40px; 
            width: 100vw; 
            box-sizing: border-box; 
            min-height: 100vh; 
            background-color: var(--paper-bg);
            background-image: linear-gradient(var(--line-color) 1px, transparent 1px);
            background-size: 100% 32px;
            position: relative;
            overflow-y: auto !important;
        }

        /* Floral Accent */
        .floral-accent {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background-image: url('https://www.transparentpng.com/download/flower/pink-flower-png-9.png');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .mantra-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .mantra-item {
            margin-bottom: 48px;
            position: relative;
            padding-left: 60px;
        }

        /* The 3 gold bars on the left */
        .mantra-bars {
            position: absolute;
            left: 0;
            top: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .bar {
            width: 30px;
            height: 4px;
            background: #f6d2a2;
            border-radius: 2px;
        }

        .mantra-text {
            font-family: 'Coming Soon', cursive;
            font-size: 11pt;
            line-height: 32px;
            color: var(--text-color);
            outline: none;
            white-space: pre-wrap;
            min-height: 32px;
        }

        .save-status { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: rgba(255,255,255,0.9); 
            padding: 5px 15px; 
            border-radius: 20px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            font-size: 10pt; 
            color: #666; 
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="content-area">
        <div class="floral-accent"></div>
        <div class="mantra-container">
            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-1"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-2"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-3"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-4"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-5"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-6"></div>
            </div>

            <div class="mantra-item">
                <div class="mantra-bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                <div class="mantra-text" contenteditable="true" id="mantra-7"></div>
            </div>
        </div>
        <div id="save-status" class="save-status">All changes saved</div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const dateParam = urlParams.get('date');
        const currentYear = dateParam ? new Date(dateParam).getFullYear() : new Date().getFullYear();
        const PERSISTENCE_KEY = `mantra-data-${currentYear}`;
        let saveTimeout;

        const DEFAULT_MANTRAS = [
            "I am choosing depth over noise. I no longer confuse being needed with being called, and I understand that silence is not avoidance—it is where I hear God, my intuition, and my own wisdom most clearly. I will schedule solitude the way others schedule meetings, because if my calendar has no white space, something is out of alignment. Rest is not a reward for productivity; it is a responsibility I owe to my body, my mind, and my spirit.",
            "I lead without shrinking. I have earned my seat at the table, and when necessary, I am capable of building the table myself. I will speak when I know something and step forward when I am ready, not when I am pressured. Visibility does not require apology, and leadership does not require loudness. It requires clarity, consistency, and the courage to stand steady even when it would be easier to disappear.",
            "I build what grounds me. I value practical skills that feed people, calm homes, and create stability. There is dignity in old ways done well, and in returning to work that uses my hands and steadies my nervous system. When life feels chaotic, I come back to the tangible and the orderly. Creating structure is how I restore peace.",
            "I serve with boundaries. I help people who are willing to participate in their own growth, and I release the need to rescue, overextend, or prove my worth through exhaustion. My generosity is intentional, not reactive, and my compassion does not require self-abandonment. I am allowed to care deeply without carrying everything.",
            "I protect joy as a non-negotiable. Not every moment must be productive to be valuable. Some moments exist simply to be remembered—shared meals, laughter, road trips, quiet conversations, and ordinary days that become sacred because I was fully present. Joy is not a distraction from my purpose; it is evidence that I am living it.",
            "I trust the pace of my life. I am not late, not behind, and not missing anything meant for me. I am becoming. I will not rush what is meant to mature, and I will not carry what was never mine to hold. Consistency matters more than urgency, and faith steadies me when fear tries to speak louder.",
            "I am building a life where work is meaningful but not consuming, leadership is steady rather than frantic, service is impactful without being depleting, and home is calm instead of chaotic. My faith remains central, my values guide my choices, and my peace is protected on purpose. I move forward with intention, rooted rather than rushed, trusting that this way of living is not only sustainable—it is right."
        ];

        async function init() {
            if (typeof setGlobalHeaderTitle === 'function') {
                setGlobalHeaderTitle(`${currentYear} MANTRAS`);
            }
            
            // Load data
            const data = await fetchPlannerData(PERSISTENCE_KEY);
            
            for (let i = 1; i <= 7; i++) {
                const el = document.getElementById(`mantra-${i}`);
                const saved = data ? data.find(d => d.field_id === `mantra-${i}`) : null;
                el.innerText = saved ? saved.content : DEFAULT_MANTRAS[i-1];
                
                el.oninput = () => handleSave(`mantra-${i}`, el.innerText);
            }
        }

        async function handleSave(fieldId, content) {
            const status = document.getElementById('save-status');
            status.innerText = 'Saving...';
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(async () => {
                if (typeof savePlannerData === 'function') {
                    const result = await savePlannerData(PERSISTENCE_KEY, fieldId, content);
                    status.innerText = result !== null ? 'All changes saved' : 'Error saving';
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>